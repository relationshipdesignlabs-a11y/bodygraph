<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bodygraph Renderer</title>
<style>
  html,body{margin:0;height:100%;background:#fff}
  .wrap{display:flex;align-items:center;justify-content:center;min-height:100%;background:#fff}
  #view{width:100%;max-width:720px;aspect-ratio: 2/3;border:0;display:block;background:#fff;border-radius:8px;overflow:hidden}
  #engine{position:fixed;left:-9999px;top:-9999px;width:800px;height:1200px;border:0}
</style>
</head>
<body>
<div class="wrap">
  <iframe id="view"></iframe>
  <iframe id="engine" src="WORKING-5.html" loading="eager"></iframe>
</div>
<script>
const engine=document.getElementById('engine');const view=document.getElementById('view');
function injectNoGateBorderCSS(doc){try{const style=doc.createElement('style');style.textContent=`.gate-dot,.gate circle{stroke:none!important}.gate-defined{stroke:none!important}`;doc.head.appendChild(style);}catch(_){}};
function mirrorSVG(){try{const ed=engine.contentDocument;const vd=view.contentDocument;if(!ed||!vd)return;const svg=ed.querySelector('svg#svg')||ed.querySelector('svg');if(!svg)return;const html=`<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>html,body{margin:0;height:100%;background:#fff}</style></head><body>${svg.outerHTML}</body></html>`;vd.open();vd.write(html);vd.close();}catch(_){}};
window.applyBodygraph=function(json){try{if(engine.contentWindow&&typeof engine.contentWindow.applyBodygraph==='function'){engine.contentWindow.applyBodygraph(json);setTimeout(mirrorSVG,50);}}catch(_){}};
engine.addEventListener('load',()=>{injectNoGateBorderCSS(engine.contentDocument);setTimeout(mirrorSVG,80);try{const obs=new MutationObserver(()=>mirrorSVG());const root=engine.contentDocument.querySelector('svg#svg')?.parentNode||engine.contentDocument.body;obs.observe(root,{subtree:true,childList:true,attributes:true,characterData:true});}catch(_){}});
</script>
</body>
</html>