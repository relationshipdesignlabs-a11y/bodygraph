<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chart details</title>
<style>
  :root{
    --ring:#e1e6e8; --cyan:#00d5ff; --ink:#0a0f12;
  }
  html,body{margin:0;height:100%;background:#fff;font-family: ui-sans-serif,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0a0f12}
  .wrap{max-width:1200px;margin:0 auto;padding:20px;display:grid;grid-template-columns: 1fr 320px; gap:16px}
  .card{background:#fff;border:1px solid var(--ring);border-radius:12px;padding:12px}
  .frameWrap{border:1px solid var(--ring); border-radius:12px; overflow:hidden; background:#fff; height:70vh; display:flex}
  #chartFrame{flex:1; border:0; width:100%; height:100%; background:#fff}
  h1{margin:0 0 8px;font-size:18px}
  .muted{color:#6b7a80;font-size:12px}
  .list{display:grid; gap:8px; font-size:14px}
  .row{display:grid; grid-template-columns: 130px 1fr; gap:8px; border-bottom:1px dashed #edf1f2; padding-bottom:6px}
  .row:last-child{border-bottom:none}
  .key{color:#516166}
  .val{font-weight:700}
  .actions{display:flex; gap:8px; margin-top:10px}
  .btn{appearance:none;border:1px solid #cfd6d9;border-radius:10px;padding:10px 14px;background:#fff;cursor:pointer}
  .btn:hover{border-color:#aab5b9}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 id="title"></h1>
    <div class="muted" id="utc"></div>
    <div class="frameWrap">
      <iframe id="chartFrame" src="WORKING.html#details" loading="eager"></iframe>
    </div>
    <div class="actions">
      <button class="btn" onclick="history.back()">Back</button>
      <a class="btn" href="./" style="text-decoration:none;display:inline-block">Home</a>
    </div>
  </div>

  <div class="card">
    <h1>Basics</h1>
    <div class="list" id="basics"></div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);
const pad2 = n => String(n).padStart(2,'0');

function putBasics(json){
  const rows = [
    ["Aura Type", json.type],
    ["Profile", json.profile],
    ["Strategy", json.strategy],
    ["Authority", json.authority],
    ["Incarnation Cross", json.incarnation_cross],
    ["Defined Channels", (json.channels_long && json.channels_long.length) ? json.channels_long.join(", ") : (json.channels_short || []).join(", ")],
    ["Definition", json.definition],
    ["Signature", json.signature],
    ["Not-self theme", json.not_self_theme]
  ];
  const list = $("#basics"); list.innerHTML = "";
  for(const [k,v] of rows){
    const row = document.createElement("div"); row.className="row";
    const key = document.createElement("div"); key.className="key"; key.textContent=k;
    const val = document.createElement("div"); val.className="val"; val.textContent = v || "—";
    row.appendChild(key); row.appendChild(val);
    list.appendChild(row);
  }
}

(function init(){
  const raw = sessionStorage.getItem("HD_BODYGRAPH_JSON");
  const name = sessionStorage.getItem("HD_NAME") || "";
  if(!raw){
    $("#title").textContent = name || "Your chart";
    $("#basics").innerHTML = "<div class='row'><div class='key'>Note</div><div class='val'>No chart data in session — return to Home and generate again.</div></div>";
    return;
  }
  const json = JSON.parse(raw);
  $("#title").textContent = name || "Your chart";

  const utc = json.birth_date_UTC ? new Date(json.birth_date_UTC) : null;
  $("#utc").textContent = utc ? `UTC: ${utc.getUTCFullYear()}-${pad2(utc.getUTCMonth()+1)}-${pad2(utc.getUTCDate())} ${pad2(utc.getUTCHours())}:${pad2(utc.getUTCMinutes())}` : "";

  // Render the same filled chart inside the iframe
  const frame = document.getElementById("chartFrame");
  const callApply = ()=>{
    try{
      if(frame.contentWindow && typeof frame.contentWindow.applyBodygraph === "function"){
        frame.contentWindow.applyBodygraph(json);
        // Hide any editor UI inside iframe
        const doc = frame.contentDocument;
        if(doc){
          const hide = doc.createElement("style");
          hide.textContent = `
            .section,#leftPanel,#centerPanel,#gatePanel,#channelPanel,#workspace,#modeSection,#verticalGuideSection,#dataSection,
            #gGrid,#gGuide,#grid,#guide,#handles,#centerline,#gCenterline,#controls,#bgfile,#showGrid,#snap,#snapStep,
            #showGuide,#guideX,#magnet,#centerOnGuide,#save,#load,#loadSampleBtn { display:none !important; }
            html,body,#svg { background:#fff !important; }
          `;
          doc.head.appendChild(hide);
        }
      }else{
        setTimeout(callApply, 120);
      }
    }catch(e){
      setTimeout(callApply, 120);
    }
  };
  if(frame.complete){ callApply(); }
  else{ frame.addEventListener("load", callApply, {once:true}); }

  putBasics(json);
})();
</script>
</body>
</html>
